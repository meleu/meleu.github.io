---
layout: post
title: DHCP + NAT = Servidor de Internet
date: '2009-03-19T03:48:00.006-03:00'
author: Meleu Zord
tags:
- Linux
- DHCP
- NAT
modified_time: '2009-03-19T04:33:42.130-03:00'
blogger_id: tag:blogger.com,1999:blog-1613465446497619833.post-2927895847376048445
blogger_orig_url: http://mdicas.blogspot.com/2009/03/dhcp-nat-servidor-de-internet.html
---

A configuração do dhcp eu li só esta pequena pincelada sem nenhum aprofundamento teórico: <a href="http://www.guiadohardware.net/tutoriais/servidor-linux-domestico/pagina4.html">http://www.guiadohardware.net/tutoriais/servidor-linux-domestico/pagina4.html</a>.<br /><br />Essa pérola sobre o NAT eu li em <a href="ttp://www.revsys.com/writings/quicktips/nat.html">http://www.revsys.com/writings/quicktips/nat.html</a>.<br /><br />A seguir é uma adaptação destas dicas para as minhas necessidades.<br /><br /><B>Cenário</B><br />Essa necessidade surgiu para mim quando eu passei a TER que usar conexão 3G por não chegar ADSL na minha nova moradia. Só que esse lance de ter um modem 3G tipo um pendrive é uma coisa meio individualista, e eu estava acostumado a ter a minha redezinha com vários computadores conectados a internet pra toda a família.<br /><br />Pois bem, uma solução rápida e rasteira que encontrei foi me conectar a internet com meu laptop (Ubuntu GNU/Linux), conectar meu laptop na redezinha local (para isso é necessário um HUB ou algo do tipo), habilitar um servidor DHCP no laptop e habilitar NAT no laptop. Pronto! Tenho um servidor de internet!<br /><br />É claro que não é muito interessante fazer isso em redes grandes! Na verdade eu só testei servindo internet para apenas um computador além do laptop com o GNU/Linux, mas não vejo problemas em servir para mais unzinho (dividir com mais de três deve tornar a navegação muito irritante).<br /><br /><B>Como Fazer</B><br /><u>Só lembrando</u>: estou conectado a internet via modem 3G utilizando a porta USB e tenho a interface ethernet livre.<br /><br />Certifique-se que o dhcpd está instalado:<br /><blockquote><br />apt-get install dhcp3-server<br /></blockquote><br /><br />Depois crie um arquivo de configuração para o dhcpd. Eu criei um arquivo chamado mdhcpd.conf da seguinte maneira (qualquer dúvida, olhar a fonte de consulta):<br /><blockquote><br /># Configuração do dhcpd para se tornar um servidor de internet<br /># para a rede local.<br />#<br /># feito por meleu, março/2009<br />#<br /># fonte de consulta:<br /># http://www.guiadohardware.net/dicas/configurando-servidor-dhcp.html<br />#<br /><br />##########<br />ddns-update-style none;<br /><br /># Tempo em segundos para revalidação dos endereços IP<br />default-lease-time 600;<br /><br /># Tempo máximo em que uma estação usa um determinado IP<br />max-lease-time 86400;<br /><br /># Este servidor será o servidor oficial de DHCP na rede local,<br /># caso contrário a diretica 'authoritative' deve ser comentada<br />authoritative;<br /><br /># o endereço da rede local será 192.168.60<br />subnet 192.168.60.0 netmask 255.255.255.0 {<br /><br /># os endereços IP dos clientes vai de 192.168.60.100-200<br /> range 192.168.60.100 192.168.60.201;<br /><br /># IMPORTANTE: é necessário que a interface do mubuntu com a<br /># rede local tenha IP 192.168.60.1<br /> option routers 192.168.60.1;<br /><br /># servidores DNS (são os que consegui pela conexão do Claro 3G)<br /># posteriormente posso tentar via OpenDNS<br /> option domain-name-servers 200.169.118.22,200.169.117.22;<br /><br /># broadcast, o óbvio<br /> option broadcast-address 192.168.60.255;<br />}<br /></blockquote><br /><br /><br />Beleza. Até aqui eu só faço a primeira vez. As instruções daqui pra baixo é que eu faço quando quero tornar meu laptop um servidor de internet.<br /><br />Primeiro defino um endereço IP para eth0. Pode ser desse jeito:<br /><blockquote><br />ifconfig eth0 192.168.60.1 netmask 255.255.255.0<br /></blockquote><br /><br />Agora chamamos o dhcpd e dizemos para ele que o arquivo de configuração é o mdhcpd.conf:<br /><blockquote><br />dhcpd3 -cf mdhcpd.conf<br /></blockquote><br /><br />E pra finalizar, habilitamos o NAT bem rápido e rasteiro. Vale ressaltar que eth0 é a minha interface com a rede local, e ppp0 é a interface conectada a internet (pode ser necessário fazer alguma adaptação). Qualquer dúvida, consultar a documentação do iptables.<br /><blockquote><br />sysctl net.ipv4.ip_forward=1<br />iptables -t nat -A POSTROUTING -o ppp0 -j MASQUERADE<br />iptables -A FORWARD -i ppp0 -o eth0 -m state --state RELATED,ESTABLISHED -j ACCEPT<br />iptables -A FORWARD -i eth0 -o ppp0 -j ACCEPT<br /></blockquote><br /><br />Pronto! Agora eu e minha esposa não ficamos mais brigando para ver quem vai acessar a internet!