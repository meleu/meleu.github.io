---
layout: post
title: Instalacao basica do Arch Linux
date: '2014-06-29T03:35:00.002-03:00'
author: meleu
tags:
- arch linux
- linux
modified_time: '2014-07-18T00:46:02.560-03:00'
blogger_id: tag:blogger.com,1999:blog-1613465446497619833.post-6324557340529418582
blogger_orig_url: http://mdicas.blogspot.com/2014/06/instalacao-basica-do-arch-linux.html
---

Estou me aventurando pelo Arch Linux (e estou empolgado!). Aqui colocarei o meu jeito de instalar o Arch. A maneira que descrevo na verdade é como se fosse um checklist para me servir como um lembrete para futuras instalações. Isso não é uma explicação para novos usuários. Se você está lendo isso e não está familiarizado com termos como /dev/sda, dd, cfdisk, mount, /mnt, e afins, talvez seja o caso de tentar uma distribuição Linux mais amigável (eu recomendo a Linux Mint &lt;<a href="http://www.linuxmint.com/">http://www.linuxmint.com/</a>&gt;). Mas se mesmo assim você quiser se aventurar pelo Arch Linux, eu indico a leitura do <a href="https://wiki.archlinux.org/index.php/Installation_Guide">Installation Guide</a>. Eu aprendi muita coisa lá. ;-)<br /><br />Se você está pensando "Tá bom, mais uma das milhares de distribuições Linux que aparecem por aí... Por que eu deveria tentar essa tal de Arch Linux?", está pensando certíssimo! Eu pensei a mesma coisa. Mas aí fui me informando sobre o Arch e consequentemente fui me lembrando daquele meu velho sonho utópico de linuxeiro adolescente: montar um sistema "from scratch", enxutinho, só com os programas que eu vou realmente utilizar. Montar o seu sistema Arch Linux, é como se fosse montar um Linux "from scratch", só que bem mais fácil! ;-)<br /><br />Com o Arch você terá um sistema enxutinho, só com os programas que VOCÊ escolheu instalar. E muitas outras vantagens (comunidade ativa, sistema rolling release, etc.). Se quer saber quais são elas olhe aqui: <a href="https://wiki.archlinux.org/index.php/Arch_Linux_%28Portugu%C3%AAs%29">https://wiki.archlinux.org/index.php/Arch_Linux_%28Portugu%C3%AAs%29</a><br /><br />Ao final das etapas descritas neste post teremos um sistema Arch Linux superbasicão, cru, sem adereço algum (tá bom, na verdade teremos dois adereços: grub como bootloader, e capacidade de se conectar em uma rede). Vamos à instalação.<br /><h3>Primeira etapa - baixando o disco de instalação e preparando uma mídia bootável</h3>Baixar o iso: <a href="http://www.archlinux.org/download">http://www.archlinux.org/download</a><br /><br />Criar um pendrive de boot (OBS.: é interessante que o pendrive não esteja montado em diretório algum):<br /><br /># dd bs=4M if=/caminho/ate/archlinux.iso of=/dev/sdx<br /># sync<br /><br /><h3>Segunda etapa - instalando um sistema basicão</h3>- Dar boot pelo pendrive usb preparado na primeira etapa.<br /><br /><br />- Assim que der de cara com o prompt, configurar teclado:<br /><br /># loadkeys br-abnt2<br /><br /><br />- Configurar sua conexão. Caso tenha wifi disponível, isso aqui resolve:<br /><br /># wifi-menu<br /><br />Caso esteja atrás de um proxy, comigo funcionou assim:<br /><br /># export http_proxy="http://user:password@proxyserver:proxyport/"<br /># export ftp_proxy=$http_proxy<br /># export https_proxy=$http_proxy<br /># export rsync_proxy=$http_proxy<br /># export no_proxy="127.0.0.1,localhost" <br /><br />Ainda no proxy... editar o arquivo /etc/pacman.conf e descomentar a linha que contém isso aqui:<br /><br /># XferCommand = /usr/bin/wget --passive-ftp -c -O %o %u<br /><br />Fiz isso no pacman.conf pois por algum motivo o pacman não foi capaz de me atenticar no proxy. O wget vai de boa. [E essa pra mim foi uma das primeiras demonstrações do poder do Arch Linux: deixar você ciente do que está acontecendo e te dar oportunidade de resolver o problema. Outras distribuições falariam algo do tipo "Conexão falhou. Verifique sua conexão e tente novamente mais tarde."]<br /><br /><br />- Editar o arquivo /etc/pacman.d/mirrorlist para utilizarmos os mirrors geograficamente mais próximos.<br /><br />Tem também a dica de rankear os mirrors<br /><br /># cp /etc/pacman.d/mirrorlist /etc/pacman.d/mirrorlist.backup<br /># rankmirrors -n 6 /etc/pacman.d/mirrorlist.backup &gt; /etc/pacman.d/mirrorlist<br /><br /><br />- Particionar disco(s) ao gosto do freguês. Usar cfdisk para isso é uma boa pedida. OBS.: não criei partição swap, mais pra frente criarei um arquivo swap para este propósito.<br /><br /><br />- Formatar as partições. Como não sou profundo conhecedor das vantagens/desvantagens de todos os sistemas de arquivos disponíveis, fui no basicão: ext4.<br /><br /># mkfs.ext4 /dev/sdxX<br /><br /><br />- Montar a partição que será raiz em /mnt.<br /><br /># mount /dev/sdxX /mnt<br /><br /><br />- Instalar o sistema na nova partição. Para instalar um sistema o mais basicão possível e mais o grub como bootloader, basta isso:<br /><br /># pacstrap /mnt base grub<br /><br />Mas como no novo sistema você certamente vai precisar de uma conexão para instalar novos pacotes, é importante instalar agora as ferramentas que permitirão realizar esta conexão. No caso de estar usando uma conexão wifi, eu usaria isso:<br /><br /># pacstrap /mnt base grub netctl dialog wireless_tools wpa_supplicant<br /><br /><br />Neste passo veremos outra ótima característica do Arch, resolução de dependências. Ao instalar estes pacotes, serão instalados automaticamente todos os pacotes dos quais os primeiros são dependentes.<br /><br />No caso de estar atras de um proxy, eu tive que usar isso:<br /><br /># pacstrap /mnt base grub wget net-tools dhcpcd<br /><br /><br />- Criar o /etc/fstab no novo sistema:<br /><br /># genfstab -p /mnt &gt;&gt; /mnt/etc/fstab<br /><br />(Calma que o swap vem depois!)<br /><br /><br />- Vamos usar o chroot para fazer de conta que estamos no sistema novo:<br /><br /># arch-chroot /mnt<br /><br /><br />- Depois de um chroot o diretório raiz já é o do novo sistema. <br /><br /><br />- Executar o mkinitcpio. Vou ser bastante sincero, não estudei muito o que o mkinitcpio faz. Apenas executei na configuração padrão mesmo.<br /><br /># mkinitcpio -p linux<br /><br /><br />- Configurar o grub:<br /><br /># grub-install --target=i386-pc --recheck --debug /dev/sdx<br /># grub-mkconfig -o /boot/grub/grub.cfg<br /><br /><br />- Criar um arquivo de swap:<br /><br /># fallocate -l 512M /swapfile<br /># chmod 600 /swapfile<br /># mkswap /swapfile<br /># swapon /swapfile<br /><br />Avisar ao /etc/fstab que temos swap! Incluir esta linha no arquivo:<br /><br />/swapfile none swap defaults 0 0<br /><h3>Terceira etapa - pequenas configurações na munheca</h3>- Escrever o nome do host em /etc/hostname<br /><br /><br />- Configurar a zona geográfica:<br /><br /># ln -s /usr/share/zoneinfo/Brazil/East /etc/localtime<br /><br /><br />- Retirar o comentário dos locales desejados no arquivo "/etc/locale.gen". Eu escolhi en_US.UTF-8 e pt_BR.UTF-8. Em seguida executar:<br /><br /># locale-gen<br /><br /><br />- Configurar "/etc/locale.conf". O meu ficou assim:<br /><br />LANG=pt_BR.UTF-8<br />LC_MESSAGES=en_US.UTF-8<br /><br /><br />- Configurar "/etc/vconsole.conf". O meu ficou assim:<br /><br />KEYMAP=br-abnt2<br /><br /><br />- Estes dois passos só precisam ser feito no caso do proxy:<br /><br />&nbsp; - Editar o /etc/pacman.conf para usar o wget, se necessário (caso do proxy), pois aquela edição que fizemos anteriormente era no sistema "instalador", agora estamos no sistema recentemente instalado, lembra? ;-)<br /><br />&nbsp; - Ainda no caso do proxy, é interessante habilitarmos logo o dhcpcd (no comando abaixo, substitua eth0 pelo nome da sua interface de rede, se for o caso):<br /><br /># systemctl enable dhcpcd@eth0.service<br /><br /><br />- Configurar uma senha para o root.<br /><br /><br />- Sair do ambiente chroot.<br /><br /># exit<br /><br />Agora a raiz já é novamente o sistema instalador do LiveCD. Desmontaremos o /mnt e rebootamos:<br /><br /># umount -R /mnt<br /># reboot<br /><br /><br />Pronto! Agora o Arch Linux já está instalado! Porém o sistema está cruzão. A customização é assunto para um próximo post.<br /><br />P.S.: outros pacotes que eu gosto muito: vim, openbsd-netcat, nmap, lynx... 